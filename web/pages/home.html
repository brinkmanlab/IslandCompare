<!-- DataTables -->
<link rel="stylesheet" href="../plugins/datatables/dataTables.bootstrap.css">
<!-- Dropzone -->
<link rel="stylesheet" href="../dist/css/dropzone.css">

<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        Home
    </h1>
    <ol class="breadcrumb">
        <li class="active"><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
    </ol>
</section>

<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-xs-6">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Recent Jobs</h3>
                </div><!-- /.box-header -->
                <div class="box-body">

                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div>
        <!-- ./col-xs-6 -->
        <div class="col-xs-6">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Upload Genomes</h3>
                </div>
                <div class="box-body">
                    <form id="genomeUploadForm">
                        Drop gbk or embl files here or click to upload.
                        <div id="genomePreviewBox" class="dropzone-previews"></div>
                    </form>
                </div>
                </div>
            </div>
        </div>
        <!-- ./col-xs-6 -->
    </div>
    <!-- ./row -->
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Uploaded Genomes</h3>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <table id="uploaded-genomes" class="table table-bordered table-hover table-striped" width="100%">
                        <thead>
                        <tr>
                            <th>Genome</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Run Analysis</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                    <!-- form start -->
                    <form role="form">
                        <div class="form-group">
                            <label for="analysis-name-field">Analysis Name</label>
                            <input type="text" class="form-control" id="analysis-name-field">
                        </div>
                        <div class="form-group">
                            <label for="selected-genomes-field">Selected Genomes</label>
                            <select multiple="" class="form-control" id="selected-genomes-field"></select>
                        </div>
                        <button type="submit" class="btn btn-block btn-primary btn-flat">
                            Start Analysis
                        </button>
                    </form>
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
</section>
<!-- /.content -->



<!-- DataTables -->
<script src="../plugins/datatables/datatables.select.min.js"></script>
<script src="../plugins/datatables/dataTables.bootstrap.min.js"></script>
<!-- DropZone -->
<script src="../plugins/dropzone/dropzone.js"></script>
<!-- Urls -->
<script src="../dist/js/islandcompare-rest-urls.js"></script>

<!-- page script -->
<script>
    $(document).ready(function () {
        var genomesTable = $("#uploaded-genomes").DataTable({
            ajax: {
                url: genomesUrl,
                dataSrc: '',
                beforeSend: function (request) {
                    request.setRequestHeader("Authorization", 'Token'+' '+getAuthenticationCookie());
                }
            },
            columns: [
                { data: 'name' }
            ],
            select: {
                style: 'multi'
            },
            rowId: 'id'
        });

        genomesTable.on( 'select', function (e, dt, type, indexes) {
            var data = genomesTable.rows(indexes).data()[0];
            $("#selected-genomes-field").append($('<option>', {
                value: data['id'],
                text : data['name']
            }));
            var selectList = $('#selected-genomes-field option').sort(function(a, b){
                return a.value-b.value;
            });
            $('#selected-genomes-field').html(selectList);
        } );

        genomesTable.on( 'deselect', function (e, dt, type, indexes) {
            var data = genomesTable.rows(indexes).data()[0];
            $('#selected-genomes-field option[value=' + data['id'] + ']').remove();
        } );

        $("#selected-genomes-field").dblclick(function (){
            var row = genomesTable.row('#'+$(this).val());
            row.deselect();
        })
    });

    $("form#genomeUploadForm").dropzone({
        url: genomesUploadUrl,
        paramName: "genomes",
        previewsContainer:"#genomePreviewBox",
        acceptedFiles:".gb,.gbff,.gbk,.genbank",
        headers: {
            "Cache-Control": "",
            "Authorization": 'Token'+' '+getAuthenticationCookie()
        },
        success: function(){
            ReloadGenomesTable();
        }
    });
</script>
</body>
</html>
